{"is_source_file": true, "format": "Python", "description": "This file defines FastAPI routes related to data preview and ingestion for a backend service. It includes endpoints for listing datasets, listing sheets within a dataset, paginating rows from sheets with search and ordering, retrieving table schemas, and triggering JSON ingestion. It manages access controls for ingestion based on a shared secret or local IP, and interacts with a SQLite database for metadata and data retrieval.", "external_files": ["../database", "../ingestion/json_loader"], "external_methods": ["get_db_connection", "run_json_ingestion", "_normalize_identifier"], "published": ["router", "IngestionResult", "list_datasets", "list_sheets", "get_rows", "get_schema", "ingest_json"], "classes": [{"name": "IngestionResult", "description": "Model representing the result of a JSON ingestion process."}, {"name": "DatasetListItem", "description": "Model representing a dataset with associated tables."}, {"name": "SheetInfo", "description": "Model representing metadata about a sheet within a dataset, including row count."}, {"name": "RowPage", "description": "Model representing a paginated set of rows including total count and limits."}, {"name": "TableSchema", "description": "Model representing the schema of a table with column names and types."}], "methods": [{"name": "bool _client_is_local(request: Request)", "description": "Checks if the request originates from a local address.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_table(table: str)", "description": "Sanitizes and validates a table name or identifier.", "scope": "", "scopeKind": ""}, {"name": "List[Tuple[str,str]] _dataset_tables(dataset: str)", "description": "Retrieves tables and sheets associated with a dataset prefix from the database.", "scope": "", "scopeKind": ""}, {"name": "get_rows( dataset: str, sheet: str, limit: int = Query(50, ge=1, le=200), offset: int = Query(0, ge=0), search: Optional[str] = Query(None, max_length=200), order_by: Optional[str] = Query(None, description=\"Column to order by\"), order_dir: str = Query(\"asc\", pattern=\"^(?i)(asc|desc)$\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "get_schema(table: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ingest_json( request: Request, x_admin_secret: Optional[str] = Header(default=None, alias=\"X-Admin-Secret\") )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "list_datasets()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "list_sheets(dataset: str)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["get_db_connection", "run_json_ingestion"], "search-terms": ["FastAPI routes", "dataset listing", "sheets listing", "row pagination", "schema retrieval", "JSON ingestion trigger", "SQLite metadata", "protected ingestion endpoint"], "state": 2, "file_id": 7, "knowledge_revision": 22, "git_revision": "065df23472e281fd09949ae2d564d9b7e195e4d7", "revision_history": [{"15": ""}, {"22": "065df23472e281fd09949ae2d564d9b7e195e4d7"}], "ctags": [{"_type": "tag", "name": "ADMIN_SECRET", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^ADMIN_SECRET = os.environ.get(\"ADMIN_SHARED_SECRET\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DatasetListItem", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class DatasetListItem(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "IngestionResult", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class IngestionResult(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "RowPage", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class RowPage(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SheetInfo", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class SheetInfo(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TableSchema", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class TableSchema(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ALLOWED_ORDER_DIR", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^_ALLOWED_ORDER_DIR = {\"asc\", \"desc\"}$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_client_is_local", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^def _client_is_local(request: Request) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "_dataset_tables", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^def _dataset_tables(dataset: str) -> List[Tuple[str, str]]:$/", "language": "Python", "typeref": "typename:List[Tuple[str,str]]", "kind": "function", "signature": "(dataset: str)"}, {"_type": "tag", "name": "_sanitize_table", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^def _sanitize_table(table: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(table: str)"}, {"_type": "tag", "name": "columns", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    columns: List[Dict[str, str]] = Field(..., description=\"List of columns with types\")$/", "language": "Python", "typeref": "typename:List[Dict[str, str]]", "kind": "variable", "scope": "TableSchema", "scopeKind": "class"}, {"_type": "tag", "name": "count", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    count: int = Field(..., description=\"Row count\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "SheetInfo", "scopeKind": "class"}, {"_type": "tag", "name": "dataset", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    dataset: str = Field(..., description=\"Dataset base name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "DatasetListItem", "scopeKind": "class"}, {"_type": "tag", "name": "files", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    files: List[Dict[str, Any]] = Field(..., description=\"Per-file ingestion summary\")$/", "language": "Python", "typeref": "typename:List[Dict[str, Any]]", "kind": "variable", "scope": "IngestionResult", "scopeKind": "class"}, {"_type": "tag", "name": "get_rows", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def get_rows($/", "language": "Python", "kind": "function", "signature": "( dataset: str, sheet: str, limit: int = Query(50, ge=1, le=200), offset: int = Query(0, ge=0), search: Optional[str] = Query(None, max_length=200), order_by: Optional[str] = Query(None, description=\"Column to order by\"), order_dir: str = Query(\"asc\", pattern=\"^(?i)(asc|desc)$\"), )"}, {"_type": "tag", "name": "get_schema", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def get_schema(table: str):$/", "language": "Python", "kind": "function", "signature": "(table: str)"}, {"_type": "tag", "name": "ingest_json", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def ingest_json($/", "language": "Python", "kind": "function", "signature": "( request: Request, x_admin_secret: Optional[str] = Header(default=None, alias=\"X-Admin-Secret\") )"}, {"_type": "tag", "name": "limit", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    limit: int = Field(..., ge=1, le=200, description=\"Page size\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}, {"_type": "tag", "name": "list_datasets", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def list_datasets():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "list_sheets", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def list_sheets(dataset: str):$/", "language": "Python", "kind": "function", "signature": "(dataset: str)"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    message: Optional[str] = Field(None, description=\"Message for empty or status cases\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "IngestionResult", "scopeKind": "class"}, {"_type": "tag", "name": "offset", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    offset: int = Field(..., ge=0, description=\"Offset\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}, {"_type": "tag", "name": "root", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    root: str = Field(..., description=\"Root path scanned\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "IngestionResult", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    rows: List[Dict[str, Any]] = Field(..., description=\"Rows\")$/", "language": "Python", "typeref": "typename:List[Dict[str, Any]]", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}, {"_type": "tag", "name": "sheet", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    sheet: str = Field(..., description=\"Sheet name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "SheetInfo", "scopeKind": "class"}, {"_type": "tag", "name": "table", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    table: str = Field(..., description=\"Fully qualified table name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "SheetInfo", "scopeKind": "class"}, {"_type": "tag", "name": "table", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    table: str = Field(..., description=\"Table name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TableSchema", "scopeKind": "class"}, {"_type": "tag", "name": "tables", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    tables: List[str] = Field(..., description=\"Table names associated with dataset\")$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable", "scope": "DatasetListItem", "scopeKind": "class"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    total: int = Field(..., description=\"Total rows (after filter)\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}], "hash": "2152cfc27160811bfd99607aae16fee5", "format-version": 4, "code-base-name": "career_platform_backend", "filename": "career_platform_backend/src/api/routers/data_preview.py", "fields": [{"name": "ADMIN_SECRET = os.environ.get(\"ADMIN_SHARED_SECRET\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_ALLOWED_ORDER_DIR = {\"asc\", \"desc\"}", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Dict[str, str]] columns", "scope": "TableSchema", "scopeKind": "class", "description": "unavailable"}, {"name": "int count", "scope": "SheetInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "str dataset", "scope": "DatasetListItem", "scopeKind": "class", "description": "unavailable"}, {"name": "List[Dict[str, Any]] files", "scope": "IngestionResult", "scopeKind": "class", "description": "unavailable"}, {"name": "int limit", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] message", "scope": "IngestionResult", "scopeKind": "class", "description": "unavailable"}, {"name": "int offset", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}, {"name": "str root", "scope": "IngestionResult", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Dict[str, Any]] rows", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}, {"name": "str sheet", "scope": "SheetInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "str table", "scope": "SheetInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "List[str] tables", "scope": "DatasetListItem", "scopeKind": "class", "description": "unavailable"}, {"name": "int total", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}]}