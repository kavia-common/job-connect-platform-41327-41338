{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for dataset preview, ingestion trigger, and schema information in a FastAPI application. It includes routes for listing datasets, sheets, getting rows, schema details, and triggering JSON ingestion; handles security via secret headers and local IP checks.", "external_files": ["../database", "../ingestion/json_loader"], "external_methods": ["get_db_connection", "run_json_ingestion", "_normalize_identifier"], "published": ["ingest_json", "list_datasets", "list_sheets", "get_rows", "get_schema"], "classes": [{"name": "IngestionResult", "description": "Model representing the result of an ingestion process, including root path, file summaries, and optional message."}, {"name": "DatasetListItem", "description": "Model representing a dataset name with associated tables."}, {"name": "SheetInfo", "description": "Model representing sheet details including name, table, and row count."}, {"name": "RowPage", "description": "Model representing a paginated set of rows, total count, and paging info."}, {"name": "TableSchema", "description": "Model representing a table name and list of columns with their types."}], "methods": [{"name": "ingest_json( request: Request, x_admin_secret: Optional[str] = Header(default=None, alias=\"X-Admin-Secret\") )", "description": "API route to trigger JSON data ingestion with shared secret or local IP check.", "scope": "", "scopeKind": ""}, {"name": "list_datasets()", "description": "API route to list available datasets and their tables.", "scope": "", "scopeKind": ""}, {"name": "list_sheets(dataset: str)", "description": "API route to list sheets within a dataset with row counts.", "scope": "", "scopeKind": ""}, {"name": "get_rows( dataset: str, sheet: str, limit: int = Query(50, ge=1, le=200), offset: int = Query(0, ge=0), search: Optional[str] = Query(None, max_length=200), order_by: Optional[str] = Query(None, description=\"Column to order by\"), order_dir: str = Query(\"asc\", pattern=\"^(?i)(asc|desc)$\"), )", "description": "API route to fetch paginated rows from a dataset sheet, with search and ordering options.", "scope": "", "scopeKind": ""}, {"name": "get_schema(table: str)", "description": "API route to fetch inferred schema for a specified table.", "scope": "", "scopeKind": ""}, {"name": "bool _client_is_local(request: Request)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Tuple[str,str]] _dataset_tables(dataset: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str _sanitize_table(table: str)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["run_json_ingestion", "get_db_connection", "conn.execute"], "search-terms": ["FastAPI dataset preview routes", "ingest-json endpoint", "list_datasets", "list_sheets", "get_rows", "get_schema", "admin secret", "local IP check", "dataset tables", "sheet info", "pagination rows", "schema inference"], "state": 2, "file_id": 7, "knowledge_revision": 15, "git_revision": "", "ctags": [{"_type": "tag", "name": "ADMIN_SECRET", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^ADMIN_SECRET = os.environ.get(\"ADMIN_SHARED_SECRET\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DatasetListItem", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class DatasetListItem(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "IngestionResult", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class IngestionResult(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "RowPage", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class RowPage(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SheetInfo", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class SheetInfo(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TableSchema", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^class TableSchema(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ALLOWED_ORDER_DIR", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^_ALLOWED_ORDER_DIR = {\"asc\", \"desc\"}$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_client_is_local", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^def _client_is_local(request: Request) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "_dataset_tables", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^def _dataset_tables(dataset: str) -> List[Tuple[str, str]]:$/", "language": "Python", "typeref": "typename:List[Tuple[str,str]]", "kind": "function", "signature": "(dataset: str)"}, {"_type": "tag", "name": "_sanitize_table", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^def _sanitize_table(table: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(table: str)"}, {"_type": "tag", "name": "columns", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    columns: List[Dict[str, str]] = Field(..., description=\"List of columns with types\")$/", "language": "Python", "typeref": "typename:List[Dict[str, str]]", "kind": "variable", "scope": "TableSchema", "scopeKind": "class"}, {"_type": "tag", "name": "count", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    count: int = Field(..., description=\"Row count\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "SheetInfo", "scopeKind": "class"}, {"_type": "tag", "name": "dataset", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    dataset: str = Field(..., description=\"Dataset base name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "DatasetListItem", "scopeKind": "class"}, {"_type": "tag", "name": "files", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    files: List[Dict[str, Any]] = Field(..., description=\"Per-file ingestion summary\")$/", "language": "Python", "typeref": "typename:List[Dict[str, Any]]", "kind": "variable", "scope": "IngestionResult", "scopeKind": "class"}, {"_type": "tag", "name": "get_rows", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def get_rows($/", "language": "Python", "kind": "function", "signature": "( dataset: str, sheet: str, limit: int = Query(50, ge=1, le=200), offset: int = Query(0, ge=0), search: Optional[str] = Query(None, max_length=200), order_by: Optional[str] = Query(None, description=\"Column to order by\"), order_dir: str = Query(\"asc\", pattern=\"^(?i)(asc|desc)$\"), )"}, {"_type": "tag", "name": "get_schema", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def get_schema(table: str):$/", "language": "Python", "kind": "function", "signature": "(table: str)"}, {"_type": "tag", "name": "ingest_json", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def ingest_json($/", "language": "Python", "kind": "function", "signature": "( request: Request, x_admin_secret: Optional[str] = Header(default=None, alias=\"X-Admin-Secret\") )"}, {"_type": "tag", "name": "limit", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    limit: int = Field(..., ge=1, le=200, description=\"Page size\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}, {"_type": "tag", "name": "list_datasets", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def list_datasets():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "list_sheets", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^async def list_sheets(dataset: str):$/", "language": "Python", "kind": "function", "signature": "(dataset: str)"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    message: Optional[str] = Field(None, description=\"Message for empty or status cases\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "IngestionResult", "scopeKind": "class"}, {"_type": "tag", "name": "offset", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    offset: int = Field(..., ge=0, description=\"Offset\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}, {"_type": "tag", "name": "root", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    root: str = Field(..., description=\"Root path scanned\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "IngestionResult", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    rows: List[Dict[str, Any]] = Field(..., description=\"Rows\")$/", "language": "Python", "typeref": "typename:List[Dict[str, Any]]", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}, {"_type": "tag", "name": "sheet", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    sheet: str = Field(..., description=\"Sheet name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "SheetInfo", "scopeKind": "class"}, {"_type": "tag", "name": "table", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    table: str = Field(..., description=\"Fully qualified table name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "SheetInfo", "scopeKind": "class"}, {"_type": "tag", "name": "table", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    table: str = Field(..., description=\"Table name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TableSchema", "scopeKind": "class"}, {"_type": "tag", "name": "tables", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    tables: List[str] = Field(..., description=\"Table names associated with dataset\")$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable", "scope": "DatasetListItem", "scopeKind": "class"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/job-connect-platform-41327-41338/career_platform_backend/src/api/routers/data_preview.py", "pattern": "/^    total: int = Field(..., description=\"Total rows (after filter)\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "RowPage", "scopeKind": "class"}], "hash": "bf594d1399b182fee6058dd8d7ecf908", "format-version": 4, "code-base-name": "career_platform_backend", "filename": "career_platform_backend/src/api/routers/data_preview.py", "fields": [{"name": "ADMIN_SECRET = os.environ.get(\"ADMIN_SHARED_SECRET\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_ALLOWED_ORDER_DIR = {\"asc\", \"desc\"}", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Dict[str, str]] columns", "scope": "TableSchema", "scopeKind": "class", "description": "unavailable"}, {"name": "int count", "scope": "SheetInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "str dataset", "scope": "DatasetListItem", "scopeKind": "class", "description": "unavailable"}, {"name": "List[Dict[str, Any]] files", "scope": "IngestionResult", "scopeKind": "class", "description": "unavailable"}, {"name": "int limit", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] message", "scope": "IngestionResult", "scopeKind": "class", "description": "unavailable"}, {"name": "int offset", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}, {"name": "str root", "scope": "IngestionResult", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Dict[str, Any]] rows", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}, {"name": "str sheet", "scope": "SheetInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "str table", "scope": "SheetInfo", "scopeKind": "class", "description": "unavailable"}, {"name": "List[str] tables", "scope": "DatasetListItem", "scopeKind": "class", "description": "unavailable"}, {"name": "int total", "scope": "RowPage", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"15": ""}]}